<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bus Routes</title>
  <link rel="stylesheet" href="styles.css">
  <!-- Leaflet Map CSS & JS (no key needed!) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <style>
    #bus-list {
      display: flex;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
      margin: 25px 0;
      gap: 18px;
    }
    .bus-btn,
    #bus-list button {
      background-color: #fff;
      color: #4CAF50;
      border: 2px solid #4CAF50;
      box-shadow: 0 2px 12px rgba(76,175,80,0.10);
      font-weight: bold;
      font-size: 1.18em;
      border-radius: 18px;
      padding: 14px 24px;
      margin: 0 8px;
      transition: background 0.2s, color 0.2s, box-shadow 0.2s, transform 0.12s;
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }
    .bus-btn:hover,
    #bus-list button:hover {
      background-color: #4CAF50;
      color: #fff;
      box-shadow: 0 4px 20px rgba(76,175,80,0.18);
      transform: scale(1.05);
    }
    .bus-btn:active,
    #bus-list button:active {
      transform: scale(0.97);
    }
    .bus-btn .ripple,
    #bus-list button .ripple {
      position: absolute;
      border-radius: 50%;
      background: rgba(255,255,255,0.45);
      transform: scale(0);
      animation: ripple-effect 0.6s linear;
      pointer-events: none;
    }
    @keyframes ripple-effect {
      to {
        transform: scale(4);
        opacity: 0;
      }
    }
    #map {
      width: 100%;
      height: 400px;
      margin-top: 30px;
      border-radius: 8px;
      display: none;
    }
    #route-stops {
      background: rgba(255,255,255,0.98);
      box-shadow: 0 3px 24px rgba(60,80,120,0.17);
      border-radius: 15px;
      padding: 22px 30px;
      margin: 24px auto 0 auto;
      width: 92%;
      max-width: 350px;
      color: #333;
      font-size: 1.07em;
      outline: 2px solid #eee;
      transition: box-shadow 0.22s;
    }
    #route-stops h3 {
      margin-bottom: 12px;
      color: #219150;
      font-size: 1.13em;
      letter-spacing: 1px;
    }
    .stop-interactive {
      padding: 7px 16px;
      margin-bottom: 4px;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.14s, color 0.14s;
    }
    .stop-interactive:hover {
      background: #e6f9ec;
      color: #26a857;
      font-weight: bold;
    }
    .stop-interactive.active {
      background: #43cd7b;
      color: #fff;
      font-weight: bold;
    }
    #search-again-btn {
      margin-top: 12px;
      padding: 8px 20px;
      background: #4CAF50;
      color: #fff;
      border-radius: 12px;
      font-size: 1em;
      border: none;
      cursor: pointer;
      transition: background 0.18s, box-shadow 0.18s;
    }
    #search-again-btn:hover {
      background: #219150;
      box-shadow: 0 1px 7px #21915044;
    }
    @media (max-width: 750px) {
      #route-stops { padding: 10px 7px; max-width: 98%; }
      .bus-btn, #bus-list button { font-size: 1em; padding: 10px 14px;}
      #map { height: 280px; }
    }
  </style>
</head>
<body>
  <div id="bus-routes-container">
    <h1 id="route-info">Bus Routes</h1>
    <div id="bus-list"></div>
    <button id="search-again-btn" style="display:none;">Search Again</button>
  </div>
  <div id="map"></div>
  <div id="route-stops" style="display:none; margin-top:10px;"></div>

  <script>
    let map;
    let routeLine;
    let markers = [];

    const routes = [
      {
        from: 'Kengeri',
        to: 'Yelahanka',
        buses: ['401K', '401KB', '401M'],
        routeCoordinates: [
          [12.9236, 77.4987],
          [12.9300, 77.5100],
          [12.9400, 77.5200],
          [12.9450, 77.5300],
          [12.9539, 77.6309],
          [12.9600, 77.5800],
          [12.9700, 77.5600],
          [13.0035, 77.5800],
          [13.1035, 77.5762],
        ],
      },
      {
  from: 'Koramangala',
  to: 'Electronic City',
  buses: ['340E', '356C'],
  routeCoordinates: [
    [12.9352, 77.6245],
    [12.9172, 77.6232],
    [12.8904, 77.6090],
    [12.8390, 77.6748]
  ],
},
{
  from: 'Banashankari',
  to: 'Malleswaram',
  buses: ['45E', '176', '96A'],
  routeCoordinates: [
    [12.9222, 77.5757],
    [12.9502, 77.5665],
    [12.9900, 77.5690],
    [13.0087, 77.5699]
  ],
},
// ...add others as needed
    ];

    function getQueryParams() {
      const urlParams = new URLSearchParams(window.location.search);
      return {
        fromLocation: urlParams.get('from'),
        toLocation: urlParams.get('to'),
      };
    }

    function displayBusRoutes() {
      const { fromLocation, toLocation } = getQueryParams();
      const busList = document.getElementById('bus-list');
      const routeInfo = document.getElementById('route-info');
      const searchBtn = document.getElementById('search-again-btn');

      let route =
        routes.find(r => r.from === fromLocation && r.to === toLocation) ||
        routes.find(r => r.from === toLocation && r.to === fromLocation);

      if (!route) {
        routeInfo.textContent = "No buses available for this route";
        searchBtn.style.display = "block";
        return;
      }

      routeInfo.textContent = `${fromLocation} to ${toLocation} - Bus Routes:`;
      busList.innerHTML = "";

      // Centered, animated bus number buttons
      route.buses.forEach(bus => {
        const button = document.createElement('button');
        button.textContent = bus;
        button.className = 'bus-btn';
        button.style.position = 'relative';
        button.addEventListener('click', function(e) {
          const ripple = document.createElement('span');
          ripple.className = 'ripple';
          const rect = button.getBoundingClientRect();
          ripple.style.left = (e.clientX - rect.left) + 'px';
          ripple.style.top = (e.clientY - rect.top) + 'px';
          ripple.style.width = ripple.style.height = Math.max(rect.width, rect.height) + 'px';
          button.appendChild(ripple);
          setTimeout(() => ripple.remove(), 600);
        });
        button.onclick = function () {
          showRouteOnMap(route.routeCoordinates);
        };
        busList.appendChild(button);
      });
      searchBtn.style.display = "block";
      searchBtn.onclick = () => {
        window.location.href = "index.html";
      };
    }

    function showRouteOnMap(coordinates) {
      // Show the map
      document.getElementById('map').style.display = "block";

      // If map doesn't exist, create and center it on first point
      if (!map) {
        map = L.map('map').setView(coordinates[0], 12);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          maxZoom: 19,
        }).addTo(map);
      } else {
        map.setView(coordinates[0], 12);
        routeLine && map.removeLayer(routeLine);
        markers.forEach(marker => map.removeLayer(marker));
        markers = [];
      }

      // Draw route polyline
      routeLine = L.polyline(coordinates, {
        color: "#4CAF50",
        weight: 4,
        opacity: 0.9,
      }).addTo(map);

      // Add markers for stops
      markers = coordinates.map((coord, idx) => {
        let marker = L.marker(coord)
          .bindPopup(`Stop ${idx+1}: [${coord[0].toFixed(4)}, ${coord[1].toFixed(4)}]`)
          .addTo(map);
        return marker;
      });

      // Interactive stops CARD
      const stopsDiv = document.getElementById("route-stops");
      stopsDiv.style.display = "block";
      stopsDiv.innerHTML = `<h3>Route Stops:</h3>` +
        coordinates.map((coord, idx) =>
          `<div class="stop-interactive" data-stop="${idx}">
            Stop ${idx + 1}: [${coord[0].toFixed(4)}, ${coord[1].toFixed(4)}]
          </div>`
        ).join("");

      // Add click for each stop: highlight, center, open popup
      document.querySelectorAll('.stop-interactive').forEach((elem, idx) => {
        elem.onclick = function() {
          document.querySelectorAll('.stop-interactive').forEach(e => e.classList.remove('active'));
          elem.classList.add('active');
          map.setView(coordinates[idx], 14);
          markers[idx].openPopup();
        };
      });
    }

    window.onload = displayBusRoutes;
  </script>
</body>
</html>

